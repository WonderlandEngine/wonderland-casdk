<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding meta -->
    
    
    <meta name="author" content="Jonathan Hale" />
    
    <meta name="description" content="API Documentation of the Construct Arcade SDK for Wonderland Engine." />
    
    

    <!-- Adding external script-->
    

    <!-- Adding external style-->
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>
      wonderland-casdk.js
    </title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/reset.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-light.css">
    
    <svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path
                    d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z" />
                <path
                    d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z" />
            </g>
        </symbol>
        <symbol id='search-icon' viewBox="0 0 512 512">
            <g>
                <g>
                    <path
                        d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z" />
                </g>
            </g>
            <g>
                <g>
                    <path
                        d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z" />
                </g>
            </g>
        </symbol>
        <symbol id="down-icon" viewBox="0 0 16 16">
            <path 
                fill-rule="evenodd" 
                clip-rule="evenodd" 
                d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"
            >
            </path>
        </symbol>
    </defs>
</svg>
  </head>

  <body>

    <nav class="navbar" id="navbar">
      <div class="navbar-heading" id="navbar-heading"><a href="index.html"><h2 class="navbar-heading-text">Construct Arcade SDK for Wonderland Engine</h2></a></div><div class="search-box" id="search-box"><div class="search-box-input-container"><input class="search-box-input" type="text" placeholder="Search..." id="search-box-input" /><svg class="search-icon" alt="search-icon"><use xlink:href="#search-icon"></use></svg></div><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-main-content" id="sidebar-main-content"><ul><li class="menu-li"><a href='https://wonderlandengine.com/' class=' menu-link' id='' target='_blank'>Wonderland Engine Website</a></li><li class="menu-li"><a href='https://github.com/WonderlandEngine/wonderland-casdk' class=' menu-link' id='' target='_blank'>GitHub Repository</a></li></ul><div class="accordion collapsed" id="7282126" > <h3 class="accordion-heading">Classes<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="casdk.html">casdk</a></li><li class="accordion-list" id=""><a href="casdk-coin-balance.html">casdk-coin-balance</a></li><li class="accordion collapsed child" id=491907><div class="accordion-heading child"><a href="casdk-leaderboard.html">casdk-leaderboard</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="casdk-leaderboard.html#.setLeaderboardId">setLeaderboardId</a></li><li data-type='method'><a href="casdk-leaderboard.html#.setValueRenderer">setValueRenderer</a></li><li data-type='method'><a href="casdk-leaderboard.html#.submit">submit</a></li><li data-type='method'><a href="casdk-leaderboard.html#.updateTexts">updateTexts</a></li></ul></li><li class="accordion-list" id=""><a href="casdk-login-button.html">casdk-login-button</a></li><li class="accordion-list" id=""><a href="casdk-purchase-button.html">casdk-purchase-button</a></li><li class="accordion collapsed child" id=2483393><div class="accordion-heading child"><a href="casdk-user-message.html">casdk-user-message</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="casdk-user-message.html#.updateUsername">updateUsername</a></li></ul></li></ul> </div><div class="accordion collapsed" id="5005001" > <h3 class="accordion-heading">Namespaces<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion collapsed child" id=7112298><div class="accordion-heading child"><a href="WLCASDK.html">WLCASDK</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="WLCASDK.html#.getCatalog">getCatalog</a></li><li data-type='method'><a href="WLCASDK.html#.getInventory">getInventory</a></li><li data-type='method'><a href="WLCASDK.html#.getUser">getUser</a></li><li data-type='method'><a href="WLCASDK.html#.init">init</a></li><li data-type='method'><a href="WLCASDK.html#.login">login</a></li><li data-type='method'><a href="WLCASDK.html#.openCoinStore">openCoinStore</a></li><li data-type='method'><a href="WLCASDK.html#.purchaseItem">purchaseItem</a></li></ul></li></ul> </div><div class="accordion collapsed" id="8742269" > <h3 class="accordion-heading">Global<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="global.html#Item">Item</a></li><li class="accordion-list" id=""><a href="global.html#User">User</a></li><li class="accordion-list" id=""><a href="global.html#ValueRenderer">ValueRenderer</a></li></ul> </div></div>
      

    </nav>
    <div class="navbar-ham" id="navbar-ham">
      <div>
        <div class="first"></div>
        <div class="second"></div>
        <div class="third"></div>
      </div>
    </div>

    <div id="main" class="main-content">
      
      <h1 id='page-title' class="page-title">
        wonderland-casdk.js
      </h1>
      

      



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
MIT License

Copyright (c) 2021 Wonderland GmbH

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/

if(typeof WL === 'undefined') {
    var WL = {
        /* Shim for running tests */
        registerComponent: function() {},
        Type: {}
    };
}

/**
 * Wrapper class for CASDK to handle callbacks and other boilterplate tasks
 * @namespace
 */
export class WLCASDK {
    /**
     * Current game id
     * @type {string?}
     */
    static gameId = null;

    /**
     * @typedef Item
     * @property {string} itemId Item ID
     * @property {number} price Price
     */

    /**
     * Current logged in player inventory
     * @type {Item[]}
     */
    static inventory = [];

    /**
     * Catalog of purchasable items for initialized game id
     * @type {Item[]}
     */
    static catalog = [];

    /**
     * Initialize CASDK with given game id.
     *
     * If you use the `casdk` comopnent, this will already be called for you.
     *
     * @param {boolean} debug Whether to enable debug mode to allow using the wrapper in local development environments.
     * @param {string?} gameId Game id to initialize with.
     */
    static init(debug = false, gameId = null) {
        this.inventory = [];
        this.gameId = gameId;
        if(typeof casdk === 'undefined' &amp;&amp; debug) {
            this.debug = true;
            this.debugIsLoggedIn = false;
            this.updateLoginStatus({detail: {status: "none"}});
            return;
        }

        window.addEventListener('casdk-login-status', this.updateLoginStatus.bind(this));
    }

    /** Call when balance is updated */
    static balanceUpdateCallbacks = [];
    static updateCoinBalance() {
        (this.debug ?  new Promise((resolve, _) => {
            /* Simulate a delayed request return */
            setTimeout(function() {
                resolve({currency: 42});
            }.bind(this), 1000);
        }) : casdk.getAmountCurrency()).then(function(a) {
            if(a.error) return;
            for(const f of this.balanceUpdateCallbacks) f(a.currency);
        }.bind(this));
    }

    /**
     * Call when login status changes
     */
    static loginStatusChangeCallbacks = [];
    /* (internal) Calls all `loginStatusChangeCallbacks` */
    static updateLoginStatus(e) {
        if(e.detail.status === 'connected') {
            for(const f of this.loginStatusChangeCallbacks) f(true);
            this.getInventory();
            this.updateCoinBalance();
        } else {
            for(const f of this.loginStatusChangeCallbacks) f(false);
        }
    }

    /**
     * Call when player inventory is updated
     */
    static inventoryUpdateCallbacks = [];
    /**
     * Fetch inventory for logged in player
     */
    static async getInventory() {
        (this.debug ?
            new Promise((resolve, _) => {
                /* Simulate a delayed request return */
                setTimeout(function() {
                    resolve({inventory: ['debug']});
                }.bind(this), 1000);
        }) : casdk.getInventory()).then((i) => {
            this.activePurchase = false;
            if(!i.inventory) {
                inventory = [];
                return;
            }
            this.inventory = i.inventory;
            for(const f of this.inventoryUpdateCallbacks) f(false);
        }).catch(function() {
          this.inventory = [];
          this.activePurchase = false;
        }.bind(this));
    }

    /**
     * Call when game catalog is updated
     */
    static catalogUpdateCallbacks = [];
    /** Fetch catalog for your game */
    static async getCatalog() {
        if(this.debug) {
            console.warn("[wonderland-casdk] Debug catalog calls are not supported");
            console.warn("[wonderland-casdk] getCatalog() called");
            return
        }
        return casdk.getCatalog(this.gameId).then(function(c) {
            this.catalog = c.catalog;
            if(!casdk.isLoggedIn()) {
                return;
            }
            this.getInventory();
        }.bind(this));
    }

    /**
     * @brief Purchase an item
     *
     * Opens the coin store if the player's balance is insufficient.
     *
     * @param {Item} item Item to purchase with price that is currently known for this item.
     */
    static async purchaseItem(item) {
        if(this.activePurchase || !this.catalog) return;

        this.activePurchase = true;

        if(this.debug) {
            console.warn("[wonderland-casdk] Debug item purchase calls are not supported");
            console.warn("[wonderland-casdk] purchaseItem() called with item:", item);
            return
        }
        if(!casdk.isLoggedIn()) {
            this.login();
            return;
        }

        if(item &amp;&amp; !this.itemOwned) {
            casdk.purchaseItem(this.gameId, item.itemId, item.price)
                .then(this.unlock.bind(this))
                .catch(function(err){
                    if(err.error == "Not enough funds") {
                        openCoinStore();
                    }
                    this.activePurchase = false;
                }.bind(this));
        }
    }

    /** Opens the coin store browser page.  */
    static openCoinStore() {
        if(WL.xrSession) {
            WL.xrSession.end().then(function() {
                const w = window.open('/coin');
                w.addEventListener('beforeunload', () => {
                    this.updateCoinBalance();
                });
            });
        } else {
            const w = window.open('/coin');
            w.addEventListener('beforeunload', () => {
                this.updateCoinBalance();
            });
        }
    }

    /**
     * Opens the login popup.
     */
    static async login() {
        if(this.debug) {
            return new Promise((resolve, _) => {
                /* Simulate a delayed request return */
                setTimeout(function() {
                    this.debugIsLoggedIn = true;
                    this.updateLoginStatus({detail: {status: "connected"}});
                    resolve(true);
                }.bind(this), 500);
            });
        }
        if(WL.xrSession) {
            return WL.xrSession.end().then(function() {
                return casdk.loginButtonPressed();
            });
        } else {
            return casdk.loginButtonPressed();
        }
    }

    /**
     * @typedef User
     * @property {string} displayName Display name
     */
    /** Called when the user data is retrieved/updated */
    static userUpdateCallbacks = [];
    /**
     * Retrieve user information
     * @returns {Promise&lt;User>} The user data
     */
    static async getUser() {
        return (this.debug ?
            /* Simulate a delayed request return */
            new Promise((resolve, _) => {
                /* Simulate a delayed request return */
                setTimeout(function() {
                    resolve({user: {displayName: "WonderfulUser"}});
                }.bind(this), 500);
            })
        : casdk.getUser()).then((userData) => {
            if(!userData.user) return null;
            for(const f of this.userUpdateCallbacks) f(userData.user);
            return userData.user;
        });
    }
};

/**
@class casdk-login-button
@classdesc CASDK Login Button

Adds a click callback to an existing `cursor-target` (or creates one) which
opens the Construct Arcade login dialog.

If the user is already logged in, the callback will not be added.

This will eventually trigger `WLCASDK.userUpdateCallbacks`.

@property {WL.Type.Object} loginButton Optional object to disable on login.
*/
WL.registerComponent('casdk-login-button', {
    loginButton: {type: WL.Type.Object}
}, {
    init: function() {
        if(('casdk' in window) &amp;&amp; casdk.isLoggedIn()) {
            this.onLoggedIn();
            return;
        }

        /* Still add the setup for casdk in debug mode */
        WLCASDK.loginStatusChangeCallbacks.push(this.onLoginStatusChange.bind(this));
        this.target = this.object.getComponent('cursor-target') || this.object.addComponent('cursor-target');
    },

    onClick: function() {
        WLCASDK.login();
    },

    onLoggedIn: function() {
        WLCASDK.getUser();
        if(this.clickCallback) {
            this.target.removeClickFunction(this.clickCallback);
            this.clickCallback = null;
        }
        if(this.loginButton) this.loginButton.active = false;
    },

    onLoginStatusChange: function(loggedIn) {
        if(loggedIn) {
            this.onLoggedIn();
        } else {
            this.clickCallback = this.onClick.bind(this);
            this.target.addClickFunction(this.clickCallback);
            if(this.loginButton) this.loginButton.active = true;
        }
    }
});

/**
@class casdk-user-message
@classdesc CASDK User Message Component

Switches a text component attached to the same object to between
a message when logged out and a message when logged in (which can
make use of the username by `{username}`), e.g. greet the user by
his username.

@property {WL.Type.String} messageLoggedIn Message to display when user
    is logged in.
@property {WL.Type.String} messageLoggedOut Message to display when user
    is not logged in.
*/
WL.registerComponent('casdk-user-message', {
    messageLoggedIn: {type: WL.Type.String, default: "Welcome, {username}!"},
    messageLoggedOut: {type: WL.Type.String, default: "Log in to submit scores!"},
}, /** @lends casdk-user-message */ {
    start: function() {
        /* Workaround for multiline strings not available yet */
        this.messageLoggedIn = this.messageLoggedIn.replaceAll('\\n', '\n');
        this.messageLoggedOut= this.messageLoggedOut.replaceAll('\\n', '\n');

        WLCASDK.loginStatusChangeCallbacks.push(this.onLoginStatusChange.bind(this));
        WLCASDK.userUpdateCallbacks.push(this.updateUsername.bind(this));
    },

    onLoginStatusChange: function(loggedIn) {
        console.log("Login status changed", loggedIn);
        if(!loggedIn) {
            this.object.getComponent('text').text = this.messageLoggedOut;
        }
    },

    /**
     * Update username
     *
     * @param {string} u New username
     */
    updateUsername: function(u) {
        this.object.getComponent('text').text =
            this.messageLoggedIn.replaceAll('{username}', u.displayName);
    }
});

class WLCASDKLeaderboard {

    static SortOrder = {
        Ascending: 0,
        Descending: 1
    }

    static Mode = {
        World: 0,
        AroundPlayer: 1
    }

    constructor(id, options) {
        this.options = {};
        this.options.debug = options.debug || !('casdk' in window);
        this.options.sortOrder = options.sortOrder || WLCASDKLeaderboard.SortOrder.Descending;
        this.options.valueRenderer = options.valueRenderer || (v => v.toString());
        this.options.scoreStorageMultiplier = options.scoreStorageMultiplier || 1;
        this.options.maxRows = options.maxRows || 10;
        this.options.mode = options.mode || WLCASDKLeaderboard.Mode.World;

        /* Placeholder board */
        this.board = [];
        this.leaderboardId = id;
        this.leaderboards = {world: null, player: null};
    }

    toString() {
        return this.board.entries().map(pos, e => `${e.rank + 1} - ${e.displayName} - ${e.score}`).join('\n');
    }

    get columns() {
        return {
            rank: this.board.map((e) => `${e.rank + 1}`),
            displayName: this.board.map(e => e.displayName || "unknown"),
            score: this.board.map(e => this.options.valueRenderer(e.score/this.options.scoreStorageMultiplier)),
        }
    }

    /** Submit a score to the leaderboard */
    submit(score) {
        /* Math.round seems necessary to guarantee integral value */
        let submissionScore = Math.round(score * this.options.scoreStorageMultiplier);

        this.leaderboards.world = null;
        this.leaderboards.player = null;

        if(this.options.debug) {
            return new Promise((resolve, _) => {
                setTimeout(() => {
                    resolve(this.getLeaderboard());
                }, 2000)
            });
        }
        if(!casdk.isLoggedIn()) {
            /* Save score for later, in case the user wants to log in
             * now after all! */
            const scorePending = this.pendingScore != null;
            this.pendingScore = submissionScore;
            /* If there's already a submission pending, it will
             * submit the new score */
            if(!scorePending) {
                let cb;
                cb = (loggedIn) => {
                    if(loggedIn) {
                        return casdk
                            .submitScore(this.leaderboardId, this.pendingScore)
                            .then(() => {
                                this.pendingScore = null;
                                const idx = WLCASDK.loginStatusChangeCallbacks.indexOf(cb);
                                WLCASDK.loginStatusChangeCallbacks.splice(idx, 1);
                                setTimeout(this.getLeaderboard.bind(this), 400);
                            });
                    }
                };
                WLCASDK.loginStatusChangeCallbacks.push(cb);
            }
        }
        return casdk
            .submitScore(this.leaderboardId, submissionScore)
            .then(() => {
                return new Promise((resolve, _) => {
                    setTimeout(() => {
                        resolve(this.getLeaderboard());
                    }, 400)
                });
            });
    }

    /*
     * Request an update of the leaderboard entries.
     *
     * This is already done after @ref submitScore()
     */
    getLeaderboard() {
        if(this.options.debug) {
            const offset = this.options.mode ? 12 : 1;
            return new Promise((resolve, _) => {
                /* Simulate a delayed request return */
                setTimeout(function() {
                    const s = this.options.scoreStorageMultiplier;

                    let scores = [];
                    const rev = this.options.sortOrder == WLCASDKLeaderboard.SortOrder.Descending;
                    let score = rev ? 10000 : 10;
                    for(let i = 0; i &lt; this.options.maxRows + 2; ++i) {
                            score = Math.round(rev ? score - 100*Math.random() : score + 100*Math.random());
                            /* In descending order */
                            scores.push({rank: offset + i, displayName: "User" + i.toString(),
                                score: score*s});
                    }
                    resolve(scores);
                }.bind(this), 1000);
            }).then(this.onScoresRetrieved.bind(this));
        }
        const mode = this.options.mode;
        /* TODO: Allow dynamic switching between modes */
        this.displayLeaderboard =  mode;

        return casdk.getLeaderboard(this.leaderboardId,
            this.options.sortOrder == WLCASDKLeaderboard.SortOrder.Ascending,
            mode == WLCASDKLeaderboard.Mode.AroundPlayer, this.options.maxRows)
            .then((r) => {
                this.leaderboards[mode] = r.leaderboard;
                if(this.leaderboards[this.displayLeaderboard])
                    this.onScoresRetrieved(this.leaderboards[this.displayLeaderboard]);
                return r.leaderboard;
            });
    }

    onScoresRetrieved(scores) {
        if(scores == null) throw new Error("Retrieving scores failed");
        this.board = scores;
    }
};

/**
@class casdk
@classdesc CASDK Initializer

Initializes the Construct Arcade SDK.

@property {WL.Type.Bool} debug Initialize in debug mode, allowing testing without deploying to Construct Arcade
@property {WL.Type.String} gameId Your game id, retrieve one from the Construct Arcade team.
*/
WL.registerComponent('casdk', {
    debug: {type: WL.Type.Bool, default: false},
    gameId: {type: WL.Type.String, default: 'your-game-id'}
}, {
    start: function() {
        /* Timeout ensures other casdk components registered their callbacks
         * before the SDK is initialized */
        setTimeout(() => WLCASDK.init(this.debug, this.gameId), 0);
    }
});

/**
@class casdk-leaderboard
@classdesc CASDK Leaderboard

Handles updating of three leaderboard table columns and submission of scores
to the Construct Arcade API services.

@property {WL.Type.String} leaderboardId Construct Arcade Leaderboard Id, contact their support to get one
@property {WL.Type.Object} columnRank Object with text component to set to the rank column
@property {WL.Type.Object} columnName Object with text component to set to the display name column
@property {WL.Type.Object} columnScore Object with text component to set to the score column
@property {WL.Type.Int} maxRows Max amount of rows to display
@property {WL.Type.Enum} scoreType Score type for display and sorting. Penalty is "bad" score.
Time based scores expect values in deciseconds. If you need
other units, use the scoreStorageMultiplier.
@property {WL.Type.Float} scoreStorageMultiplier Multiplier to retrieve an integral value to submit to Construct Arcade leaderboards
@property {WL.Type.Enum} mode Whether to show scores around player's score or World scores, starting at 1.
*/
WL.registerComponent('casdk-leaderboard',
    {
    leaderboardId: {type: WL.Type.String, default: 'my-game-1'},
    columnRank: {type: WL.Type.Object},
    columnName: {type: WL.Type.Object},
    columnScore: {type: WL.Type.Object},
    maxRows: {type: WL.Type.Int, default: 8},
    scoreType: {type: WL.Type.Enum, values:
        ['score', 'penalty', 'longest time', 'fastest time'],
        default: 'score'},
    scoreStorageMultiplier: {type: WL.Type.Float, default: 1.0},
    mode: {type: WL.Type.Enum, values: ['world', 'player']},
}, /** @lends casdk-leaderboard */ {
    init: function() {
        if(this.scoreStorageMultiplier == 0) {
            throw new Error("scoreStorageMultiplier cannot be 0 on", this.object.name);
        }

        if(!this.columnRank) console.warn("[casdk-leaderboard] columnRank not set on", this.object.name);
        if(!this.columnName) console.warn("[casdk-leaderboard] columnName not set on", this.object.name);
        if(!this.columnScore) console.warn("[casdk-leaderboard] columnScore not set on", this.object.name);

        if(this.scoreType > 1) {
            this.valueRenderer = (v) => {
                const ds = Math.floor(v % 10); /* deciseconds */
                const s = Math.floor(v/10) % 60;
                const m = Math.floor(v/600);
                return `${m}:${s &lt; 10 ? '0' : ''}${s}.${ds}`
            };
        }
    },

    start: function() {
        this.setLeaderboardId(this.leaderboardId);
    },

    /**
     * Update texts to match internal leaderboard data.
     *
     * Usually called automatically for you.
     */
    updateTexts: function() {
        const c = this.leaderboard.columns;
        if(this.columnRank)
            this.columnRank.getComponent('text').text = c.rank.slice(0, this.maxRows).join('\n');
        if(this.columnName)
            this.columnName.getComponent('text').text = c.displayName.slice(0, this.maxRows).join('\n');
        if(this.columnScore)
            this.columnScore.getComponent('text').text = c.score.slice(0, this.maxRows).join('\n');
    },

    /**
     * Set the id of the leaderboard.
     *
     * Get ids from the Construct Arcade team, reach out to them via Discord or E-Mail.
     *
     * @param {string} newId New leaderboard id.
     */
    setLeaderboardId: function(newId) {
        this.leaderboardId = newId;

        const leaderboardSettings = {
            sortOrder: (this.scoreType &amp; 1 == 0)
                ? WLCASDKLeaderboard.SortOrder.Ascending : WLCASDKLeaderboard.SortOrder.Descending,
            maxRows: this.maxRows,
            mode: this.mode,
            scoreStorageMultiplier: this.scoreStorageMultiplier,
        };
        if(this.valueRenderer) leaderboardSettings.valueRenderer = this.valueRenderer;
        this.leaderboard = new WLCASDKLeaderboard(this.leaderboardId, leaderboardSettings);
        /* Don't retrieve empty ids */
        if(this.leaderboardId) {
            this.leaderboard.getLeaderboard()
                .then(this.updateTexts.bind(this));
        }
    },

    /**
     * @callback ValueRenderer
     *
     * Function that takes a number score value and returns a string representation.
     *
     * @param {number} score Score to convert to string.
     * @returns {string} Converted score
     */
    /**
     * Set a function for converting leaderboard score value into string.
     *
     * Calls updateTexts() if a leaderboard is currently active.
     *
     * @param {ValueRenderer} valueRenderer Function for converting scores to string
     */
    setValueRenderer: function(valueRenderer) {
        this.valueRenderer = valueRenderer;
        if(this.leaderboard) {
            this.leaderboard.options.valueRenderer;
            this.updateTexts();
        }
    },

    /**
     * Submit a score for player with given name
     *
     * @param {string} name Player name
     * @param {number} score Score to submit
     */
    submit: function(name, score) {
        this.leaderboard.submit(name, score);
        this.updateTexts();
    }
});

/**
@class casdk-coin-balance
@classdesc Construct Arcade Coin balance display

Changes a text to display the amount of coins the user
currently owns.

@property {WL.Type.Material} material Material to use when creating a text component.
    Can be `null` if the object already has a text component attached.
*/
WL.registerComponent('casdk-coin-balance', {
    material: {type: WL.Type.Material}
}, /** @lends casdk-coin-balance */ {
    init: function() {
        this.balance = '?';
        WLCASDK.balanceUpdateCallbacks.push(this.updateCoinBalance.bind(this));
    },
    start: function() {
        this.text = this.object.getComponent('text') || this.object.addComponent('text', {
            material: this.material,
            text: this.balance.toString()
        });
    },

    updateCoinBalance: function(balance) {
        this.balance = balance;
        if(this.text) this.text = balance.toString();
    }
});

/**
@class casdk-purchase-button
@classdesc Button to purchase a specific item.

Finds or creates a `cursor-target` component on the attached object
and adds a click listener to purchase given item when clicked.

@property {WL.Type.String} itemId Item to purchase
@property {WL.Type.String} expectedPrice Item to purchase
*/
WL.registerComponent('casdk-purchase-button', {
    itemId: {type: WL.Type.String, default: 'item-id'},
    expectedPrice: {type: WL.Type.Int, default: 0}
}, /** @lends casdk-purchase-button */ {
    start: function() {
        const target = this.object.getComponent('cursor-target') || this.object.addComponent('cursor-target');
        target.addClickFunction(this.onClick.bind(this));
    },

    onClick: function() {
        WLCASDK.purchaseItem({
            itemId: this.itemId,
            price: this.expectedPrice
        });
    }
});
</code></pre>
        </article>
    </section>




    </div>

    <footer class="footer" id="footer">
      
    </footer>

    <script src="scripts/third-party/prettify.js"></script>
    <script src="scripts/third-party/lang-css.js"></script>
    <script type="text/javascript" src="scripts/misc.js"></script>

    <script>prettyPrint();</script>
    <script src="scripts/linenumber.js"></script>
    <script src="scripts/fix-code-block.js"></script>
    <script src="scripts/fix-navbar.js"></script>
    
      <script src="scripts/search.js"></script>
      <script src="scripts/third-party/fuse.js"></script>
      <script>
        var list = [{"title":"casdk","link":"<a href=\"casdk.html\">casdk</a>"},{"title":"casdk-coin-balance","link":"<a href=\"casdk-coin-balance.html\">casdk-coin-balance</a>"},{"title":"casdk-leaderboard","link":"<a href=\"casdk-leaderboard.html\">casdk-leaderboard</a>"},{"title":"casdk-leaderboard.setLeaderboardId","link":"<a href=\"casdk-leaderboard.html#.setLeaderboardId\">casdk-leaderboard.setLeaderboardId &rtrif; undefined</a>"},{"title":"casdk-leaderboard.setValueRenderer","link":"<a href=\"casdk-leaderboard.html#.setValueRenderer\">casdk-leaderboard.setValueRenderer &rtrif; undefined</a>"},{"title":"casdk-leaderboard.submit","link":"<a href=\"casdk-leaderboard.html#.submit\">casdk-leaderboard.submit &rtrif; undefined</a>"},{"title":"casdk-leaderboard.updateTexts","link":"<a href=\"casdk-leaderboard.html#.updateTexts\">casdk-leaderboard.updateTexts &rtrif; undefined</a>"},{"title":"casdk-login-button","link":"<a href=\"casdk-login-button.html\">casdk-login-button</a>"},{"title":"casdk-purchase-button","link":"<a href=\"casdk-purchase-button.html\">casdk-purchase-button</a>"},{"title":"casdk-user-message","link":"<a href=\"casdk-user-message.html\">casdk-user-message</a>"},{"title":"casdk-user-message.updateUsername","link":"<a href=\"casdk-user-message.html#.updateUsername\">casdk-user-message.updateUsername &rtrif; undefined</a>"},{"title":"WLCASDK","link":"<a href=\"WLCASDK.html\">WLCASDK</a>"},{"title":"WLCASDK.getCatalog","link":"<a href=\"WLCASDK.html#.getCatalog\">WLCASDK.getCatalog &rtrif; undefined</a>"},{"title":"WLCASDK.getInventory","link":"<a href=\"WLCASDK.html#.getInventory\">WLCASDK.getInventory &rtrif; undefined</a>"},{"title":"WLCASDK.getUser","link":"<a href=\"WLCASDK.html#.getUser\">WLCASDK.getUser &rtrif; undefined</a>"},{"title":"WLCASDK.init","link":"<a href=\"WLCASDK.html#.init\">WLCASDK.init &rtrif; undefined</a>"},{"title":"WLCASDK.login","link":"<a href=\"WLCASDK.html#.login\">WLCASDK.login &rtrif; undefined</a>"},{"title":"WLCASDK.openCoinStore","link":"<a href=\"WLCASDK.html#.openCoinStore\">WLCASDK.openCoinStore &rtrif; undefined</a>"},{"title":"WLCASDK.purchaseItem","link":"<a href=\"WLCASDK.html#.purchaseItem\">WLCASDK.purchaseItem &rtrif; undefined</a>"},{"title":"Item","link":"<a href=\"global.html#Item\">Item</a>"},{"title":"User","link":"<a href=\"global.html#User\">User</a>"},{"title":"ValueRenderer","link":"<a href=\"global.html#ValueRenderer\">ValueRenderer</a>"}];
        var options = {"shouldSort":true,"threshold":0.4,"location":0,"distance":100,"maxPatternLength":32,"minMatchCharLength":1}
          setupSearch(list, options)
      </script>
    

    

    

    

    


  </body>

</html>
